---
title: v1 版本新特性
sidebarTitle: 发布说明
---

**LangChain v1 是一个专注于生产环境的代理构建基础框架。** 我们围绕三个核心改进简化了框架：

<CardGroup cols={1}>
    <Card title="createAgent" icon="robot" href="#create-agent" arrow>
        在 LangChain 中构建代理的新标准方式，用更简洁、更强大的 API 替代了 LangGraph 中的 `createReactAgent`。
    </Card>
    <Card title="标准内容块" icon="cube" href="#standard-content-blocks" arrow>
        新的 `contentBlocks` 属性，提供跨所有提供商的现代 LLM 功能的统一访问。
    </Card>
    <Card title="简化的包" icon="sitemap" href="#simplified-package" arrow>
        `langchain` 包已简化，专注于代理的核心构建块，旧功能已移至 `@langchain/classic`。
    </Card>
</CardGroup>

要升级，

<CodeGroup>
```bash npm
npm install langchain @langchain/core
```
```bash pnpm
pnpm install langchain @langchain/core
```
```bash yarn
yarn add langchain @langchain/core
```
```bash bun
bun add langchain @langchain/core
```
</CodeGroup>

有关完整的更改列表，请参阅 [迁移指南](/oss/javascript/migrate/langchain-v1)。

## `createAgent`

`createAgent` 是在 LangChain 1.0 中构建代理的标准方式。它提供了比从 LangGraph 导出的预构建 `createReactAgent` 更简单的接口，同时通过使用中间件提供更大的自定义潜力。

```ts
import { createAgent } from "langchain";

const agent = createAgent({
  model: "claude-sonnet-4-5-20250929",
  tools: [getWeather],
  systemPrompt: "You are a helpful assistant.",
});

const result = await agent.invoke({
  messages: [
    { role: "user", content: "What is the weather in Tokyo?" },
  ],
});

console.log(result.content);
```

在底层，`createAgent` 构建在基本代理循环之上——调用模型，让它选择要执行的工具，然后在不再调用工具时完成：

<div style={{ display: "flex", justifyContent: "center" }}>
  <img
    src="/oss/images/core_agent_loop.png"
    alt="Core agent loop diagram"
    className="rounded-lg"
  />
</div>

更多信息，请参阅 [代理](/oss/javascript/langchain/agents)。

### 中间件

中间件是 `createAgent` 的定义性特性。它使 `createAgent` 高度可定制，提高了您可以构建的上限。

优秀的代理需要 [上下文工程](/oss/javascript/langchain/context-engineering)：在正确的时间向模型提供正确的信息。中间件通过可组合的抽象帮助您控制动态提示、对话摘要、选择性工具访问、状态管理和防护措施。

#### 预构建中间件

LangChain 为常见模式提供了一些 [预构建中间件](/oss/javascript/langchain/middleware#built-in-middleware)，包括：

- `summarizationMiddleware`：当对话历史过长时压缩对话历史
- `humanInTheLoopMiddleware`：要求对敏感工具调用进行批准
- `piiRedactionMiddleware`：在发送到模型之前编辑敏感信息

```ts
import {
  createAgent,
  summarizationMiddleware,
  humanInTheLoopMiddleware,
  piiRedactionMiddleware,
} from "langchain";

const agent = createAgent({
  model: "claude-sonnet-4-5-20250929",
  tools: [readEmail, sendEmail],
  middleware: [
    piiRedactionMiddleware({ patterns: ["email", "phone", "ssn"] }),
    summarizationMiddleware({
      model: "claude-sonnet-4-5-20250929",
      maxTokensBeforeSummary: 500,
    }),
    humanInTheLoopMiddleware({
      interruptOn: {
        sendEmail: {
          allowedDecisions: ["approve", "edit", "reject"],
        },
      },
    }),
  ],
});
```

#### 自定义中间件

您也可以构建自定义中间件以满足您的特定需求。

通过使用 `createMiddleware` 函数实现这些钩子中的任何一个来构建自定义中间件：

| 钩子              | 运行时机             | 用例                               |
|-------------------|--------------------------|-----------------------------------------|
| `beforeAgent`     | 调用代理之前 | 加载内存，验证输入             |
| `beforeModel`     | 每次 LLM 调用之前     | 更新提示，修剪消息           |
| `wrapModelCall`   | 围绕每次 LLM 调用     | 拦截和修改请求/响应 |
| `wrapToolCall`    | 围绕每次工具调用    | 拦截和修改工具执行     |
| `afterModel`      | 每次 LLM 响应之后  | 验证输出，应用防护措施       |
| `afterAgent`      | 代理完成后    | 保存结果，清理                   |


<div style={{ display: "flex", justifyContent: "center" }}>
  <img
    src="/oss/images/middleware_final.png"
    alt="Middleware flow diagram"
    className="rounded-lg"
  />
</div>


自定义中间件示例：

```ts
import { createMiddleware } from "langchain";

const contextSchema = z.object({
  userExpertise: z.enum(["beginner", "expert"]).default("beginner"),
})

const expertiseBasedToolMiddleware = createMiddleware({
  wrapModelCall: async (request, handler) => {
    const userLevel = request.runtime.context.userExpertise;
    if (userLevel === "expert") {
      const tools = [advancedSearch, dataAnalysis];
      return handler(
        request.replace("openai:gpt-5", tools)
      );
    }
    const tools = [simpleSearch, basicCalculator];
    return handler(
      request.replace("openai:gpt-5-nano", tools)
    );
  },
});

const agent = createAgent({
  model: "claude-sonnet-4-5-20250929",
  tools: [simpleSearch, advancedSearch, basicCalculator, dataAnalysis],
  middleware: [expertiseBasedToolMiddleware],
  contextSchema,
});
```

更多信息，请参阅 [完整的中间件指南](/oss/javascript/langchain/middleware)。

### 构建在 LangGraph 之上

因为 `createAgent` 构建在 LangGraph 之上，您自动获得对长时间运行和可靠代理的内置支持，通过：

<CardGroup cols={2}>
    <Card title="持久化" icon="database">
        通过内置检查点，对话在会话之间自动持久化
    </Card>
    <Card title="流式处理" icon="water">
        实时流式传输令牌、工具调用和推理轨迹
    </Card>
    <Card title="人工介入" icon="hand">
        在敏感操作之前暂停代理执行以等待人工批准
    </Card>
    <Card title="时间旅行" icon="clock-rotate-left">
        将对话回退到任何点并探索替代路径和提示
    </Card>
</CardGroup>

您无需学习 LangGraph 即可使用这些功能——它们开箱即用。

### 结构化输出

`createAgent` 改进了结构化输出生成：

- **主循环集成**：结构化输出现在在主循环中生成，而不是需要额外的 LLM 调用
- **结构化输出策略**：模型可以在调用工具或使用提供商端结构化输出生成之间进行选择
- **成本降低**：消除了额外 LLM 调用的额外费用

```ts
import { createAgent } from "langchain";
import * as z from "zod";

const weatherSchema = z.object({
  temperature: z.number(),
  condition: z.string(),
});

const agent = createAgent({
  model: "gpt-4o-mini",
  tools: [getWeather],
  responseFormat: weatherSchema,
});

const result = await agent.invoke({
  messages: [
    { role: "user", content: "What is the weather in Tokyo?" },
  ],
});

console.log(result.structuredResponse);
```

**错误处理**：通过 `ToolStrategy` 的 `handleErrors` 参数控制错误处理：
- **解析错误**：模型生成的数据与所需结构不匹配
- **多个工具调用**：模型为结构化输出模式生成 2 个或更多工具调用

---

## 标准内容块

<Note>
    大多数包都提供了 1.0 版本。目前只有以下包支持新的内容块：

    - `langchain`
    - `@langchain/core`
    - `@langchain/anthropic`
    - `@langchain/openai`

    计划提供对内容块的更广泛支持。
</Note>

### 优势

- **提供商无关**：无论提供商如何，都使用相同的 API 访问推理轨迹、引用、内置工具（网络搜索、代码解释器等）和其他功能
- **类型安全**：所有内容块类型的完整类型提示
- **向后兼容**：标准内容可以 [延迟加载](/oss/javascript/langchain/messages#standard-content-blocks)，因此没有相关的破坏性更改

更多信息，请参阅我们的 [内容块指南](/oss/javascript/langchain/messages#message-content)

---

## 简化的包

LangChain v1 简化了 `langchain` 包的命名空间，专注于代理的核心构建块。该包仅暴露最有用的相关功能：

其中大部分从 `@langchain/core` 重新导出以便使用，为您提供专注于构建代理的 API 表面。


### `@langchain/classic`

旧功能已移至 [`@langchain/classic`](https://www.npmjs.com/package/@langchain/classic)，以保持核心包的精简和专注。

#### `@langchain/classic` 中包含的内容

- 旧版链和链实现
- 检索器
- 索引 API
- [`@langchain/community`](https://www.npmjs.com/package/@langchain/community) 导出
- 其他已弃用的功能

如果您使用任何这些功能，请安装 [`@langchain/classic`](https://www.npmjs.com/package/@langchain/classic)：

<CodeGroup>
```bash npm
npm install @langchain/classic
```
```bash pnpm
pnpm install @langchain/classic
```
```bash yarn
yarn add @langchain/classic
```
```bash bun
bun add @langchain/classic
```
</CodeGroup>

然后更新您的导入：

```typescript
import { ... } from "langchain"; // [!code --]
import { ... } from "@langchain/classic"; // [!code ++]

import { ... } from "langchain/chains"; // [!code --]
import { ... } from "@langchain/classic/chains"; // [!code ++]
```

## 报告问题

请在 [GitHub](https://github.com/langchain-ai/langchainjs/issues) 上使用 [`'v1'` 标签](https://github.com/langchain-ai/langchainjs/issues?q=state%3Aopen%20label%3Av1) 报告在 1.0 版本中发现的任何问题。

## 其他资源

<CardGroup cols={3}>
    <Card title="LangChain 1.0" icon="rocket" href="https://blog.langchain.com/langchain-langchain-1-0-alpha-releases/">
        阅读公告
    </Card>
    <Card title="中间件指南" icon="puzzle-piece" href="https://blog.langchain.com/agent-middleware/">
        深入了解中间件
    </Card>
    <Card title="代理文档" icon="book" href="/oss/javascript/langchain/agents" arrow>
        完整的代理文档
    </Card>
    <Card title="消息内容" icon="message" href="/oss/javascript/langchain/messages#message-content" arrow>
        新的内容块 API
    </Card>
    <Card title="迁移指南" icon="arrow-right-arrow-left" href="/oss/javascript/migrate/langchain-v1" arrow>
        如何迁移到 LangChain v1
    </Card>
    <Card title="GitHub" icon="github" href="https://github.com/langchain-ai/langchainjs">
        报告问题或贡献
    </Card>
</CardGroup>

## 另请参阅

- [版本控制](/oss/javascript/versioning) - 了解版本号
- [发布政策](/oss/javascript/release-policy) - 详细的发布政策

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss\javascript\releases\langchain-v1.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.
</Tip>
