---
title: INVALID_CHAT_HISTORY
---



This error is raised in the prebuilt @[createAgent][create_agent] when the `callModel` graph node receives a malformed list of messages. Specifically, it is malformed when there are `AIMessage`s with `tool_calls` (LLM requesting to call a tool) that do not have a corresponding @[`ToolMessage`] (result of a tool invocation to return to the LLM).


There could be a few reasons you're seeing this error:



1. You manually passed a malformed list of messages when invoking the graph, e.g. `graph.invoke({messages: [new AIMessage({..., tool_calls: [...]})]})`
2. The graph was interrupted before receiving updates from the `tools` node (i.e. a list of @[`ToolMessage`])
    and you invoked it with an input that is not null or a ToolMessage,
    e.g. `graph.invoke({messages: [new HumanMessage(...)]}, config)`.
    This interrupt could have been triggered in one of the following ways:
    * You manually set `interruptBefore: ['tools']` in `createAgent`
    * One of the tools raised an error that wasn't handled by the [`ToolNode`](https://reference.langchain.com/javascript/classes/langchain.index.ToolNode.html) (`"tools"`)


## Troubleshooting

To resolve this, you can do one of the following:

1. Don't invoke the graph with a malformed list of messages
2. In case of an interrupt (manual or due to an error) you can:



* provide `ToolMessage` objects that match existing tool calls and call `graph.invoke({messages: [new ToolMessage(...)]})`.
  **NOTE**: this will append the messages to the history and run the graph from the START node.
  * manually update the state and resume the graph from the interrupt:
    1. get the list of most recent messages from the graph state with `graph.getState(config)`
    2. modify the list of messages to either remove unanswered tool calls from AIMessages

or add `ToolMessage` objects with `toolCallId`s that match unanswered tool calls 3. call `graph.updateState(config, {messages: ...})` with the modified list of messages 4. resume the graph, e.g. call `graph.invoke(null, config)`

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss\langgraph\errors\INVALID_CHAT_HISTORY.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.
</Tip>
