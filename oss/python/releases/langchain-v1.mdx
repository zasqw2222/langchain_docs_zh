---
title: v1 版本新特性
sidebarTitle: 发布说明
---

**LangChain v1 是一个专注于生产环境的代理构建基础框架。** 我们围绕三个核心改进简化了框架：

<CardGroup cols={1}>
    <Card title="create_agent" icon="robot" href="#create-agent" arrow>
        在 LangChain 中构建代理的新标准，替代了 `langgraph.prebuilt.create_react_agent`。
    </Card>
    <Card title="标准内容块" icon="cube" href="#standard-content-blocks" arrow>
        新的 `content_blocks` 属性，提供跨提供商的现代 LLM 功能的统一访问。
    </Card>
    <Card title="简化的命名空间" icon="sitemap" href="#simplified-package" arrow>
        `langchain` 命名空间已简化，专注于代理的核心构建块，旧功能已移至 `langchain-classic`。
    </Card>
</CardGroup>

要升级，

<CodeGroup>
```bash pip
pip install -U langchain
```
```bash uv
uv add langchain
```
</CodeGroup>

有关完整的更改列表，请参阅 [迁移指南](/oss/python/migrate/langchain-v1)。

## `create_agent`

[`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent) 是在 LangChain 1.0 中构建代理的标准方式。它提供了比 [`langgraph.prebuilt.create_react_agent`](https://reference.langchain.com/python/langgraph/agents/#langgraph.prebuilt.chat_agent_executor.create_react_agent) 更简单的接口，同时通过使用 [中间件](#middleware) 提供更大的自定义潜力。

```python
from langchain.agents import create_agent

agent = create_agent(
    model="claude-sonnet-4-5-20250929",
    tools=[search_web, analyze_data, send_email],
    system_prompt="You are a helpful research assistant."
)

result = agent.invoke({
    "messages": [
        {"role": "user", "content": "Research AI safety trends"}
    ]
})
```

在底层，[`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent) 构建在基本代理循环之上——调用模型，让它选择要执行的工具，然后在不再调用工具时完成：

<div style={{ display: "flex", justifyContent: "center" }}>
    <img
        src="/oss/images/core_agent_loop.png"
        alt="Core agent loop diagram"
        className="rounded-lg"
    />
</div>

更多信息，请参阅 [代理](/oss/python/langchain/agents)。

### 中间件

中间件是 [`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent) 的定义性特性。它提供了一个高度可定制的入口点，提高了您可以构建的上限。

优秀的代理需要 [上下文工程](/oss/python/langchain/context-engineering)：在正确的时间向模型提供正确的信息。中间件通过可组合的抽象帮助您控制动态提示、对话摘要、选择性工具访问、状态管理和防护措施。

#### 预构建中间件

LangChain 为常见模式提供了一些 [预构建中间件](/oss/python/langchain/middleware#built-in-middleware)，包括：

- [`PIIMiddleware`](https://reference.langchain.com/python/langchain/middleware/#langchain.agents.middleware.PIIMiddleware)：在发送到模型之前编辑敏感信息
- [`SummarizationMiddleware`](https://reference.langchain.com/python/langchain/middleware/#langchain.agents.middleware.SummarizationMiddleware)：当对话历史过长时压缩对话历史
- [`HumanInTheLoopMiddleware`](https://reference.langchain.com/python/langchain/middleware/#langchain.agents.middleware.HumanInTheLoopMiddleware)：要求对敏感工具调用进行批准

```python
from langchain.agents import create_agent
from langchain.agents.middleware import (
    PIIMiddleware,
    SummarizationMiddleware,
    HumanInTheLoopMiddleware
)


agent = create_agent(
    model="claude-sonnet-4-5-20250929",
    tools=[read_email, send_email],
    middleware=[
        PIIMiddleware("email", strategy="redact", apply_to_input=True),
        PIIMiddleware(
            "phone_number",
            detector=(
                r"(?:\+?\d{1,3}[\s.-]?)?"
                r"(?:\(?\d{2,4}\)?[\s.-]?)?"
                r"\d{3,4}[\s.-]?\d{4}"
			),
			strategy="block"
        ),
        SummarizationMiddleware(
            model="claude-sonnet-4-5-20250929",
            max_tokens_before_summary=500
        ),
        HumanInTheLoopMiddleware(
            interrupt_on={
                "send_email": {
                    "allowed_decisions": ["approve", "edit", "reject"]
                }
            }
        ),
    ]
)
```

#### 自定义中间件

您也可以构建自定义中间件以满足您的需求。中间件在代理执行的每个步骤中暴露钩子：

<div style={{ display: "flex", justifyContent: "center" }}>
    <img
        src="/oss/images/middleware_final.png"
        alt="Middleware flow diagram"
        className="rounded-lg"
    />
</div>

通过在 [`AgentMiddleware`](https://reference.langchain.com/python/langchain/middleware/#langchain.agents.middleware.AgentMiddleware) 类的子类上实现这些钩子中的任何一个来构建自定义中间件：

| 钩子              | 运行时机             | 用例                               |
|-------------------|--------------------------|-----------------------------------------|
| `before_agent`    | 调用代理之前 | 加载内存，验证输入             |
| `before_model`    | 每次 LLM 调用之前     | 更新提示，修剪消息           |
| `wrap_model_call` | 围绕每次 LLM 调用     | 拦截和修改请求/响应 |
| `wrap_tool_call`  | 围绕每次工具调用    | 拦截和修改工具执行     |
| `after_model`     | 每次 LLM 响应之后  | 验证输出，应用防护措施       |
| `after_agent`     | 代理完成后    | 保存结果，清理                   |


自定义中间件示例：

```python expandable
from dataclasses import dataclass
from typing import Callable

from langchain_openai import ChatOpenAI

from langchain.agents.middleware import (
    AgentMiddleware,
    ModelRequest
)
from langchain.agents.middleware.types import ModelResponse

@dataclass
class Context:
    user_expertise: str = "beginner"

class ExpertiseBasedToolMiddleware(AgentMiddleware):
    def wrap_model_call(
        self,
        request: ModelRequest,
        handler: Callable[[ModelRequest], ModelResponse]
    ) -> ModelResponse:
        user_level = request.runtime.context.user_expertise

        if user_level == "expert":
            # More powerful model
            model = ChatOpenAI(model="gpt-5")
            tools = [advanced_search, data_analysis]
        else:
            # Less powerful model
            model = ChatOpenAI(model="gpt-5-nano")
            tools = [simple_search, basic_calculator]

        request.model = model
        request.tools = tools
        return handler(request)

agent = create_agent(
    model="claude-sonnet-4-5-20250929",
    tools=[
        simple_search,
        advanced_search,
        basic_calculator,
        data_analysis
    ],
    middleware=[ExpertiseBasedToolMiddleware()],
    context_schema=Context
)
```

更多信息，请参阅 [完整的中间件指南](/oss/python/langchain/middleware)。

### 构建在 LangGraph 之上

因为 [`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent) 构建在 [LangGraph](/oss/python/langgraph) 之上，您自动获得对长时间运行和可靠代理的内置支持，通过：

<CardGroup cols={2}>
    <Card title="持久化" icon="database">
        通过内置检查点，对话在会话之间自动持久化
    </Card>
    <Card title="流式处理" icon="water">
        实时流式传输令牌、工具调用和推理轨迹
    </Card>
    <Card title="人工介入" icon="hand">
        在敏感操作之前暂停代理执行以等待人工批准
    </Card>
    <Card title="时间旅行" icon="clock-rotate-left">
        将对话回退到任何点并探索替代路径和提示
    </Card>
</CardGroup>

您无需学习 LangGraph 即可使用这些功能——它们开箱即用。

### 结构化输出

[`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent) 改进了结构化输出生成：

- **主循环集成**：结构化输出现在在主循环中生成，而不是需要额外的 LLM 调用
- **结构化输出策略**：模型可以在调用工具或使用提供商端结构化输出生成之间进行选择
- **成本降低**：消除了额外 LLM 调用的额外费用

```python
from langchain.agents import create_agent
from langchain.agents.structured_output import ToolStrategy
from pydantic import BaseModel


class Weather(BaseModel):
    temperature: float
    condition: str

def weather_tool(city: str) -> str:
    """Get the weather for a city."""
    return f"it's sunny and 70 degrees in {city}"

agent = create_agent(
    "gpt-4o-mini",
    tools=[weather_tool],
    response_format=ToolStrategy(Weather)
)

result = agent.invoke({
    "messages": [{"role": "user", "content": "What's the weather in SF?"}]
})

print(repr(result["structured_response"]))
# results in `Weather(temperature=70.0, condition='sunny')`
```

**错误处理**：通过 `ToolStrategy` 的 `handle_errors` 参数控制错误处理：
- **解析错误**：模型生成的数据与所需结构不匹配
- **多个工具调用**：模型为结构化输出模式生成 2 个或更多工具调用

---

## 标准内容块

<Note>
    内容块支持目前仅适用于以下集成：

    - [`langchain-anthropic`](https://pypi.org/project/langchain-anthropic/)
    - [`langchain-aws`](https://pypi.org/project/langchain-aws/)
    - [`langchain-openai`](https://pypi.org/project/langchain-openai/)
    - [`langchain-google-genai`](https://pypi.org/project/langchain-google-genai/)
    - [`langchain-ollama`](https://pypi.org/project/langchain-ollama/)

    对内容块的更广泛支持将逐步在更多提供商中推出。
</Note>

新的 [`content_blocks`](https://reference.langchain.com/python/langchain_core/language_models/#langchain_core.messages.BaseMessage.content_blocks) 属性引入了跨提供商工作的消息内容标准表示：

```python
from langchain_anthropic import ChatAnthropic

model = ChatAnthropic(model="claude-sonnet-4-5-20250929")
response = model.invoke("What's the capital of France?")

# 统一访问内容块
for block in response.content_blocks:
    if block["type"] == "reasoning":
        print(f"模型推理: {block['reasoning']}")
    elif block["type"] == "text":
        print(f"响应: {block['text']}")
    elif block["type"] == "tool_call":
        print(f"工具调用: {block['name']}({block['args']})")
```

### 优势

- **提供商无关**：无论提供商如何，都使用相同的 API 访问推理轨迹、引用、内置工具（网络搜索、代码解释器等）和其他功能
- **类型安全**：所有内容块类型的完整类型提示
- **向后兼容**：标准内容可以 [延迟加载](/oss/python/langchain/messages#standard-content-blocks)，因此没有相关的破坏性更改

更多信息，请参阅我们的 [内容块指南](/oss/python/langchain/messages#standard-content-blocks)。

---

## 简化的包

LangChain v1 简化了 [`langchain`](https://pypi.org/project/langchain/) 包的命名空间，专注于代理的核心构建块。精简的命名空间暴露了最有用的相关功能：

### 命名空间

| 模块 | 可用内容 | 说明 |
|--------|------------------|-------|
| [`langchain.agents`](https://reference.langchain.com/python/langchain/agents) | [`create_agent`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.create_agent), [`AgentState`](https://reference.langchain.com/python/langchain/agents/#langchain.agents.AgentState) | 核心代理创建功能 |
| [`langchain.messages`](https://reference.langchain.com/python/langchain/messages) | 消息类型, [内容块](https://reference.langchain.com/python/langchain/messages/#langchain.messages.ContentBlock), [`trim_messages`](https://reference.langchain.com/python/langchain/messages/#langchain.messages.trim_messages) | 从 @[`langchain-core`] 重新导出 |
| [`langchain.tools`](https://reference.langchain.com/python/langchain/tools) | [`@tool`](https://reference.langchain.com/python/langchain/tools/#langchain.tools.tool), [`BaseTool`](https://reference.langchain.com/python/langchain/tools/#langchain.tools.BaseTool), 注入辅助函数 | 从 @[`langchain-core`] 重新导出 |
| [`langchain.chat_models`](https://reference.langchain.com/python/langchain/models) | [`init_chat_model`](https://reference.langchain.com/python/langchain/models/#langchain.chat_models.init_chat_model), [`BaseChatModel`](https://reference.langchain.com/python/langchain_core/language_models/#langchain_core.language_models.chat_models.BaseChatModel) | 统一的模型初始化 |
| [`langchain.embeddings`](https://reference.langchain.com/python/langchain/embeddings) | [`Embeddings`](https://reference.langchain.com/python/langchain_core/embeddings/#langchain_core.embeddings.embeddings.Embeddings), [`init_embeddings`](https://reference.langchain.com/python/langchain_core/embeddings/#langchain_core.embeddings.embeddings.Embeddings) | 嵌入模型 |

其中大部分从 `langchain-core` 重新导出以便使用，为您提供专注于构建代理的 API 表面。

```python
# 代理构建
from langchain.agents import create_agent

# 消息和内容
from langchain.messages import AIMessage, HumanMessage

# 工具
from langchain.tools import tool

# 模型初始化
from langchain.chat_models import init_chat_model
from langchain.embeddings import init_embeddings
```

### `langchain-classic`

旧功能已移至 [`langchain-classic`](https://pypi.org/project/langchain-classic)，以保持核心包的精简和专注。

**`langchain-classic` 中包含的内容：**

- 旧版链和链实现
- 检索器（例如 `MultiQueryRetriever` 或之前 `langchain.retrievers` 模块中的任何内容）
- 索引 API
- hub 模块（用于以编程方式管理提示）
- [`langchain-community`](https://pypi.org/project/langchain-community) 导出
- 其他已弃用的功能

如果您使用任何这些功能，请安装 [`langchain-classic`](https://pypi.org/project/langchain-classic)：

<CodeGroup>
```bash pip
pip install langchain-classic
```

```bash uv
uv add langchain-classic
```
</CodeGroup>

然后更新您的导入：

```python
from langchain import ...  # [!code --]
from langchain_classic import ...  # [!code ++]

from langchain.chains import ...  # [!code --]
from langchain_classic.chains import ...  # [!code ++]

from langchain.retrievers import ...  # [!code --]
from langchain_classic.retrievers import ...  # [!code ++]

from langchain import hub  # [!code --]
from langchain_classic import hub  # [!code ++]
```

## 迁移指南

请参阅我们的 [迁移指南](/oss/python/migrate/langchain-v1) 以获取将代码更新到 LangChain v1 的帮助。

## 报告问题

请在 [GitHub](https://github.com/langchain-ai/langchain/issues) 上使用 `'v1'` [标签](https://github.com/langchain-ai/langchain/issues?q=state%3Aopen%20label%3Av1) 报告在 1.0 版本中发现的任何问题。

## 其他资源

<CardGroup cols={3}>
    <Card title="LangChain 1.0" icon="rocket" href="https://blog.langchain.com/langchain-langchain-1-0-alpha-releases/">
        阅读公告
    </Card>
    <Card title="中间件指南" icon="puzzle-piece" href="https://blog.langchain.com/agent-middleware/">
        深入了解中间件
    </Card>
    <Card title="代理文档" icon="book" href="/oss/python/langchain/agents" arrow>
        完整的代理文档
    </Card>
    <Card title="消息内容" icon="message" href="/oss/python/langchain/messages#message-content" arrow>
        新的内容块 API
    </Card>
    <Card title="迁移指南" icon="arrow-right-arrow-left" href="/oss/python/migrate/langchain-v1" arrow>
        如何迁移到 LangChain v1
    </Card>
    <Card title="GitHub" icon="github" href="https://github.com/langchain-ai/langchain">
        报告问题或贡献
    </Card>
</CardGroup>

## 另请参阅

- [版本控制](/oss/python/versioning) - 了解版本号
- [发布政策](/oss/python/release-policy) - 详细的发布政策

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss\python\releases\langchain-v1.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.
</Tip>
